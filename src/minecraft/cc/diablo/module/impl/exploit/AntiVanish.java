package cc.diablo.module.impl.exploit;

import cc.diablo.event.impl.PacketEvent;
import cc.diablo.helpers.render.ChatHelper;
import cc.diablo.module.Category;
import cc.diablo.module.Module;
import com.github.steveice10.mc.auth.data.GameProfile;
import com.google.common.eventbus.Subscribe;
import net.minecraft.network.play.server.S38PacketPlayerListItem;
import org.lwjgl.input.Keyboard;
import java.util.*;

import java.util.*;

public class AntiVanish extends Module {
    private final Set<UUID> vanished = new HashSet<>();
    private final HashMap<UUID, String> uuids = new HashMap<>();

    public AntiVanish() {
        super("AntiVanish", "Detects when a player is in vanish", Keyboard.KEY_NONE, Category.Exploit);
    }
    @Override
    public void onEnable(){
        vanished.clear();
        super.onEnable();
    }


    @Subscribe
    public void onPacket(PacketEvent e){
        this.setDisplayName("AntiVanish\2477 "+vanished.size());

        if (e.getPacket() instanceof S38PacketPlayerListItem) {
            S38PacketPlayerListItem packet = (S38PacketPlayerListItem) e.getPacket();
            if (packet.func_179768_b() == S38PacketPlayerListItem.Action.UPDATE_LATENCY) {
                for (Object o : packet.func_179767_a()) {
                    S38PacketPlayerListItem.AddPlayerData data = (S38PacketPlayerListItem.AddPlayerData) o;
                    if (mc.getNetHandler().getPlayerInfo(data.getProfile().getId()) == null) {
                        if (!vanished.contains(data.getProfile().getId())) {
                            ChatHelper.addChat(data.getProfile().getId() + " is now vanished.");
                            vanished.add(data.getProfile().getId());
                        }
                    }
                }
            }
        }
    }
}
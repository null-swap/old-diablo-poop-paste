package cc.diablo.module.impl.exploit;

import cc.diablo.event.impl.UpdateEvent;
import cc.diablo.module.Category;
import cc.diablo.module.Module;
import cc.diablo.setting.impl.ModeSetting;
import cc.diablo.setting.impl.NumberSetting;
import com.google.common.eventbus.Subscribe;
import net.minecraft.client.Minecraft;
import net.minecraft.item.ItemBow;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;
import org.lwjgl.input.Keyboard;

public class FastBow extends Module {
    public ModeSetting mode = new ModeSetting("Mode","Ghostly","Ghostly");
    public NumberSetting speed = new NumberSetting("Speed",4,1,30,1);

    public FastBow(){
        super("FastBow","Fast bow", Keyboard.KEY_NONE, Category.Exploit);
        this.addSettings(mode,speed);
    }

    @Subscribe
    public void onUpdate(UpdateEvent e){
        switch (mode.getMode()){
            case "Ghostly":
                if (mc.thePlayer.getCurrentEquippedItem() != null && mc.thePlayer.getCurrentEquippedItem().getItem() instanceof ItemBow && mc.gameSettings.keyBindUseItem.pressed) {
                    if (mc.thePlayer.ticksExisted % speed.getVal() == 0) {
                        double d = mc.thePlayer.posX;
                        double d2 = mc.thePlayer.posY + 1.0E-9;
                        double d3 = mc.thePlayer.posZ;
                        mc.playerController.sendUseItem(mc.thePlayer, Minecraft.theWorld, mc.thePlayer.inventory.getCurrentItem());

                        for (int i = 0; i < 20; i++) {
                            mc.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer.C06PacketPlayerPosLook(d, d2, d3, mc.thePlayer.rotationYaw, mc.thePlayer.rotationPitch, true));
                        }
                        Minecraft.getMinecraft().getNetHandler().addToSendQueue(new C07PacketPlayerDigging(C07PacketPlayerDigging.Action.RELEASE_USE_ITEM, new BlockPos(0, 0, 0), EnumFacing.DOWN));
                        mc.thePlayer.inventory.getCurrentItem().getItem().onPlayerStoppedUsing(mc.thePlayer.inventory.getCurrentItem(), Minecraft.theWorld, mc.thePlayer, 10);
                    }
                }
                break;
        }
    }
}

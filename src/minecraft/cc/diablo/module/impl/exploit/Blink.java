package cc.diablo.module.impl.exploit;

import cc.diablo.event.impl.PacketEvent;
import cc.diablo.event.impl.TickEvent;
import cc.diablo.helpers.PacketHelper;
import cc.diablo.helpers.Stopwatch;
import cc.diablo.helpers.TimerUtil;
import cc.diablo.module.Category;
import cc.diablo.module.Module;
import cc.diablo.setting.impl.ModeSetting;
import cc.diablo.setting.impl.NumberSetting;
import com.google.common.eventbus.Subscribe;
import net.minecraft.network.Packet;
import org.lwjgl.input.Keyboard;

import java.util.ArrayList;

public class Blink extends Module {
    public ArrayList<Packet> packets  = new ArrayList<Packet>();
    public ModeSetting mode = new ModeSetting("Blink mode","Pulse","Pulse","Static");
    public NumberSetting pulseDelay = new NumberSetting("Delay",3000,50,10000,50);
    public Stopwatch timer = new Stopwatch();
    public Blink(){
        super("Blink","Delays packets from being sent", Keyboard.KEY_NONE, Category.Exploit);
        this.addSettings(mode,pulseDelay);
    }

    @Override
    public void onEnable(){
        timer.reset();
        super.onEnable();
    }
    @Override
    public void onDisable(){
        for(Packet packet : packets){
            PacketHelper.sendPacketNoEvent(packet);
        }
        packets.clear();
        timer.reset();
        super.onDisable();
    }
    @Subscribe
    public void onTick(TickEvent e){
        this.setDisplayName("Blink\2477 " + this.mode.getMode());
        switch (this.mode.getMode()){
            case "Pulse":
                if(timer.hasReached((long) this.pulseDelay.getVal())) {
                    for (Packet packet : packets) {
                        PacketHelper.sendPacketNoEvent(packet);
                    }
                    packets.clear();
                }
                break;
        }

    }
    @Subscribe
    public void onPacket(PacketEvent e){
        if(e.isOutgoing()){
            packets.add(e.getPacket());
            e.setCancelled(true);
        }
    }
}
